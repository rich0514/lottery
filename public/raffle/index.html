<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>ç°¡æ˜“æŠ½çç¨‹å¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- å¼•å…¥ SheetJS -->
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <style>
    body { font-family: 'Noto Sans TC', sans-serif; background: #F8F1E9; padding: 20px; }
    .container { max-width: 600px; margin: auto; text-align: center; }
    input, select, button { margin: 8px 0; padding: 10px; width: 100%; max-width: 300px; }
    table { width: 100%; border-collapse: collapse; margin-top: 16px; }
    th, td { border: 1px solid #CCC; padding: 8px; vertical-align: top; }
    th { background: #EEE; }
    /* è®“ cell å…§å®¹è¶…é•·æ™‚è‡ªå‹•æ›è¡Œ */
    td {
      white-space: pre-wrap;
      word-break: break-word;
    }
    .ad-flex {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: flex-start;
      width: 100vw;
      min-height: 100vh;
      box-sizing: border-box;
      column-gap: 40px; /* å·¦å³å»£å‘Šæ¬„èˆ‡ä¸»ç¨‹å¼çš„é–“è· */
    }
    .ad-column {
      display: flex;
      flex-direction: column;
      gap: 24px;
      width: 300px; /* å»£å‘Šæ¬„å¯¬åº¦ï¼Œå¯ä¾éœ€æ±‚èª¿æ•´ */
      align-items: center;
      margin-top: 40px;
    }
    .ad-card {
      width: 250px; /* å»£å‘Šå¡ç‰‡å¯¬åº¦ */
      height: 280px; /* å»£å‘Šå¡ç‰‡é«˜åº¦ */
      background: #ffe9c6;
      border-radius: 12px;
      box-shadow: 0 2px 8px #0001;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1em;
      color: #b97a00;
      font-weight: bold;
      border: 2px solid #f7b731;
    }
    .ad-card img {
      max-width: 240px; /* è¨­å®šåœ–ç‰‡æœ€å¤§å¯¬åº¦ */
      max-height: 240px; /* è¨­å®šåœ–ç‰‡æœ€å¤§é«˜åº¦ */
      width: auto; /* åœ–ç‰‡å¯¬åº¦è‡ªå‹• */
      height: auto; /* åœ–ç‰‡é«˜åº¦è‡ªå‹• */
      display: block;
      margin: 12px auto 2px auto; /* åœ–ç‰‡ä¸Šä¸‹ç•™ç™½ï¼Œç½®ä¸­ */
      border-radius: 8px; /* åœ“è§’ï¼Œå¯ä¾éœ€æ±‚èª¿æ•´ */
      /* ä½ å¯ä»¥åŠ ä¸Š box-shadow æˆ– border ç­‰æ•ˆæœ */
    }
    .ad-card .ad-text {
      color: #b97a00;         /* å»£å‘Šæ–‡å­—é¡è‰²ï¼Œå¯ä¾éœ€æ±‚èª¿æ•´ */
      text-align: center;    /* å»£å‘Šæ–‡å­—ç½®ä¸­ */
      width: 100%;           /* è®“ç½®ä¸­ç”Ÿæ•ˆ */
      margin-top: 0px;       /* åœ–ç‰‡èˆ‡æ–‡å­—é–“è· */
      font-size: 1em;        /* å­—é«”å¤§å°å¯èª¿æ•´ */
      font-weight: bold;     /* å­—é«”ç²—ç´°å¯èª¿æ•´ */
    }
    .main-center {
      flex: 1 1 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 0;
      max-width: 800px; /* ä¸»ç¨‹å¼æœ€å¤§å¯¬åº¦ */
      padding-left: 24px; /* ä¸»ç¨‹å¼å·¦å³ç•™ç™½ */
      padding-right: 24px;
    }
    /*
    èªªæ˜ï¼š
    - .ad-column width æ§åˆ¶å·¦å³å»£å‘Šæ¬„å¯¬åº¦ã€‚
    - .ad-card width/height æ§åˆ¶æ¯å¼µå»£å‘Šå¡ç‰‡å¤§å°ã€‚
    - .ad-flex column-gap æ§åˆ¶å»£å‘Šæ¬„èˆ‡ä¸»ç¨‹å¼çš„é–“è·ã€‚
    - .main-center max-width åŠ padding æ§åˆ¶ä¸»ç¨‹å¼å€åŸŸå¯¬åº¦èˆ‡å·¦å³ç•™ç™½ã€‚
    */
    @media (max-width: 900px) {
      .ad-flex {
        flex-direction: column;
        align-items: center;
        column-gap: 0;
      }
      .ad-column {
        flex-direction: row;
        width: 100%;
        gap: 12px;
        margin-top: 12px;
        justify-content: center;
      }
      .ad-card {
        width: 45vw;
        max-width: 180px;
        height: auto;
        min-width: 120px;
      }
      .main-center {
        max-width: 98vw;
        padding-left: 4vw;
        padding-right: 4vw;
      }
      .ad-card img {
        max-width: 100%;
        height: auto;
      }
    }
    /*
    RWD éŸ¿æ‡‰å¼è¨­è¨ˆï¼š
    - è¢å¹•å¯¬åº¦å°æ–¼ 900px æ™‚ï¼Œå»£å‘Šæ¬„æ©«å‘æ’åˆ—ï¼Œå¡ç‰‡ç¸®å°ï¼Œä¸»ç¨‹å¼å¯¬åº¦è‡ªé©æ‡‰ã€‚
    - æ¡Œé¢ç‰ˆæ’ç‰ˆä¸å—å½±éŸ¿ã€‚
    */
  </style>
</head>
<body>
  <div class="ad-flex">
    <div class="ad-column">
      <div class="ad-card"><a id="ad1" href="#" target="_blank"><img><div class="ad-text"></div></a></div>
      <div class="ad-card"><a id="ad2" href="#" target="_blank"><img><div class="ad-text"></div></a></div>
      <div class="ad-card"><a id="ad3" href="#" target="_blank"><img><div class="ad-text"></div></a></div>
    </div>
    <div class="main-center">
      <div class="container">
        <h1>æŠ½çç¨‹å¼</h1>
        <p>ä¸Šå‚³åå–®æª”æ¡ˆï¼ˆExcel æˆ– CSVï¼‰ï¼š</p>
        <input type="file" id="fileInput" accept=".xlsx,.csv" />
        <p>æŠ½å‡ºåé¡ï¼š</p>
        <select id="numWinners">
          <option value="1">1 äºº</option>
          <option value="2">2 äºº</option>
          <option value="3" selected>3 äºº</option>
          <option value="5">5 äºº</option>
          <option value="10">10 äºº</option>
        </select>
        <button id="drawBtn" disabled>ğŸ‰ é–‹å§‹æŠ½ç</button>
        <table id="resultTable" style="display:none;">
          <thead id="tblHead"></thead>
          <tbody id="tblBody"></tbody>
        </table>
      </div>
    </div>
    <div class="ad-column">
      <div class="ad-card"><a id="ad4" href="#" target="_blank"><img><div class="ad-text"></div></a></div>
      <div class="ad-card"><a id="ad5" href="#" target="_blank"><img><div class="ad-text"></div></a></div>
      <div class="ad-card"><a id="ad6" href="#" target="_blank"><img><div class="ad-text"></div></a></div>
    </div>
  </div>

  <script>
    let records = [], numericCols = {};

    document.getElementById('fileInput').addEventListener('change', async e => {
      const file = e.target.files[0];
      if (!file) return;
      const data = await file.arrayBuffer();
      const wb = XLSX.read(data, { type: 'array' });
      const ws = wb.Sheets[wb.SheetNames[0]];
      records = XLSX.utils.sheet_to_json(ws);
      if (records.length) {
        analyzeColumns(records);
        document.getElementById('drawBtn').disabled = false;
        alert(`å·²è¼‰å…¥ ${records.length} ç­†è³‡æ–™`);
      }
    });

    document.getElementById('drawBtn').addEventListener('click', () => {
      const n = +document.getElementById('numWinners').value;
      const winners = [];
      const copy = [...records];
      for (let i = 0; i < Math.min(n, copy.length); i++) {
        const idx = Math.floor(Math.random() * copy.length);
        winners.push(copy.splice(idx, 1)[0]);
      }
      renderTable(winners);
    });

    function analyzeColumns(data) {
      // åªåˆ¤æ–·å“ªäº›æ¬„ä½æ˜¯ç´”æ•¸å€¼ï¼Œç”¨æ–¼èª¿æ•´å¯¬åº¦
      const cols = Object.keys(data[0]);
      cols.forEach(col => {
        numericCols[col] = data.every(r => !isNaN(parseFloat(r[col])));
      });
    }

    function renderTable(data) {
      const head = document.getElementById('tblHead'),
            body = document.getElementById('tblBody');
      head.innerHTML = ''; body.innerHTML = '';
      if (!data.length) return;
      const cols = Object.keys(data[0]);

      // è¡¨é ­
      const trh = document.createElement('tr');
      cols.forEach(c => {
        const th = document.createElement('th');
        th.textContent = c;
        trh.appendChild(th);
      });
      head.appendChild(trh);

      // è¨ˆç®—æ•¸å€¼æ¬„ä½çš„æœ€å°/æœ€å¤§å€¼ï¼ˆç”¨æ–¼å¯¬åº¦ï¼‰
      const stats = {};
      cols.forEach(c => {
        if (numericCols[c]) {
          const nums = data.map(r => parseFloat(r[c]));
          stats[c] = { min: Math.min(...nums), max: Math.max(...nums) };
        }
      });

      // è³‡æ–™åˆ—
      data.forEach(row => {
        const tr = document.createElement('tr');
        cols.forEach(c => {
          let v = row[c];
          const td = document.createElement('td');

          // è¶…é 30 å­—ï¼Œè‡ªå‹•æ¯ 30 å­—æ’å…¥æ›è¡Œ
          if (typeof v === 'string' && v.length > 30) {
            v = v.match(/.{1,30}/g).join('\n');
          }

          td.textContent = v;

          // å¦‚æœæ˜¯æ•¸å€¼æ¬„ä½ï¼Œæ ¹æ“šå¤§å°èª¿æ•´å¯¬åº¦
          if (numericCols[c]) {
            const num = parseFloat(row[c]);
            const { min, max } = stats[c];
            const w = (min === max) ? 100 : 50 + ((num - min) / (max - min)) * 150;
            td.style.width = w + 'px';
          }

          tr.appendChild(td);
        });
        body.appendChild(tr);
      });

      document.getElementById('resultTable').style.display = 'table';
    }

    // å»£å‘Šè¼ªæ’­è¨­å®šï¼ˆå«åœ–ç‰‡ã€é€£çµã€æ–‡å­—ï¼‰
    const adContents = [
      [
        {img:'https://live.staticflickr.com/65535/54606029335_f4d9186d32_b.jpg', url:'https://www.instagram.com/creating_.for_.life/', text:'åŸå‰µæ’ç•«Tæ¤'},
        {img:'https://live.staticflickr.com/65535/54605530231_3024c4019b_b.jpg', url:'https://www.instagram.com/creating_.for_.life/', text:'ç°ï¼Œé»‘ï¼Œç±³ï¼Œç™½'},
        {img:'https://live.staticflickr.com/65535/54605773608_581c118706_b.jpg', url:'https://www.instagram.com/creating_.for_.life/', text:'å››è‰²å¯é¸'},
        {img:'https://live.staticflickr.com/65535/54605797900_8f4ea97dba_b.jpg', url:'https://www.instagram.com/creating_.for_.life/', text:'éš¨å¿ƒæ‰€æ¬²'},
      ],
      [
        {img:'https://live.staticflickr.com/65535/54606008995_bf02f21af4_b.jpg', url:'https://www.instagram.com/donoteat2024/', text:''},
        {img:'https://live.staticflickr.com/65535/54604833677_66dddb57a2_b.jpg', url:'https://www.instagram.com/9899_club/', text:''},
      ],
      [
        {img:'https://live.staticflickr.com/65535/54604833662_1c25afc921_b.jpg', url:'https://www.instagram.com/guagua.forest/', text:''},
        {img:'https://live.staticflickr.com/65535/54605919188_03eaf06369_b.jpg', url:'https://www.instagram.com/orderzoos/', text:''}
      ],
      [
        {img:'https://live.staticflickr.com/65535/54606008885_5114c93221_b.jpg', url:'https://www.instagram.com/shuyuflower/', text:''},
        {img:'https://live.staticflickr.com/65535/54605707901_fb2c82505a_b.jpg', url:'https://www.instagram.com/moonheart726/', text:''}
      ],
      [
        {img:'https://live.staticflickr.com/65535/54605904149_16282d9950_b.jpg', url:'https://www.instagram.com/zoedoit.macrame/', text:''},
        {img:'https://live.staticflickr.com/65535/54606008990_7e56f48383_b.jpg', url:'https://www.instagram.com/chin.chin515/', text:''}
      ],
      [
        {img:'https://live.staticflickr.com/65535/54606009000_d6716bbcac_b.jpg', url:'https://www.instagram.com/___orangeeee/', text:''},
        {img:'https://live.staticflickr.com/65535/54605707826_322bf6d01c_b.jpg', url:'https://www.instagram.com/green_tea_is_me/', text:''}
      ]
    ];
    const adLinks = [
      document.getElementById('ad1'),
      document.getElementById('ad2'),
      document.getElementById('ad3'),
      document.getElementById('ad4'),
      document.getElementById('ad5'),
      document.getElementById('ad6')
    ];
    let adIndex = [0,0,0,0,0,0];
    function updateAds() {
      for(let i=0;i<6;i++) {
        const ad = adContents[i][adIndex[i]];
        adLinks[i].href = ad.url;
        adLinks[i].querySelector('img').src = ad.img;
        adLinks[i].querySelector('.ad-text').textContent = ad.text;
      }
    }
    updateAds();
    setInterval(() => {
      for(let i=0;i<6;i++) {
        adIndex[i] = (adIndex[i]+1)%adContents[i].length;
      }
      updateAds();
    }, 3000); // æ¯3ç§’è¼ªæ’­
  </script>
</body>
</html>
